<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Material Weight & Surface Area</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Arial, sans-serif; }

        body {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            background: #f4f6f8;
            padding: 20px;
            gap: 20px;
            flex-direction: row;
        }

        .nav-header { width: 100%; position: absolute; top: 10px; left: 20px; }
        .nav-header a { text-decoration: none; color: #007bff; font-weight: bold; }

        .container {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            max-width: 1100px;
            flex: 1;
            margin-top: 40px;
            overflow-x: auto;
        }

        h3 { text-align: center; color: #333; margin-bottom: 5px; }
        h4 { text-align: center; margin-bottom: 20px; color: #666; font-size: 0.85rem; }

        table { width: 100%; border-collapse: collapse; min-width: 700px; }
        th { background: #007bff; color: white; padding: 10px; font-size: 12px; border: 1px solid #ddd; }
        td { border: 1px solid #ddd; padding: 5px; text-align: center; }

        select, input { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none; }
        .red-input { background: #fff0f0 !important; border: 2px solid #ff4d4d !important; }
        .disabled-select { background: #f0f0f0; cursor: not-allowed; }

        .btn-group { margin-top: 15px; display: flex; gap: 10px; }
        button.action-btn { padding: 10px 15px; border: none; color: white; font-weight: bold; border-radius: 5px; cursor: pointer; }
        .add-row { background: #28a745; }
        .export-xls { background: #17a2b8; }
        .del-btn { background: none; border: none; cursor: pointer; font-size: 1.2rem; color: #dc3545; }

        #totalRow td { background: #f8f9fa; font-weight: bold; border-top: 2px solid #007bff; }

        /* Calculator Styles */
        .calculator {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 320px;
            position: sticky;
            top: 20px;
            margin-top: 40px;
            flex-shrink: 0;
            color: white;
        }

        .history-panel {
            width: 100%;
            height: 100px;
            background: #2a2a2a;
            border-radius: 8px;
            margin-bottom: 10px;
            padding: 8px;
            font-size: 0.75rem;
            overflow-y: auto;
            color: #bbb;
            font-family: monospace;
            text-align: right;
            border: 1px solid #444;
        }

        .history-item { border-bottom: 1px solid #3d3d3d; padding: 4px 0; cursor: pointer; }
        .history-item:hover { color: #fff; background: #333; }

        .display { 
            width: 100%; height: 50px; background: #000; color: #0f0; border: 2px solid #333; 
            border-radius: 8px; text-align: right; padding: 10px; font-size: 24px; 
            margin-bottom: 15px; font-family: monospace; outline: none;
        }
        
        .buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .calc-btn { padding: 15px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; color: #fff; background: #333; transition: 0.2s; }
        .calc-btn:hover { background: #444; }
        .operator { background: #ff9500; }
        .equal { background: #28a745; grid-column: span 2; }
        .clear { background: #dc3545; }

        @media (max-width: 1250px) {
            body { flex-direction: column; align-items: center; }
            .container { width: 100%; }
            .calculator { position: static; width: 100%; max-width: 350px; }
        }
    </style>
</head>
<body>

<div class="nav-header"><a href="index.html">üè† Home</a></div>

<div class="container">
    <h3>Material Weight & Surface Area</h3>
    <h4>Note: fill Highlight cell</h4>

    <table id="materialTable">
        <thead>
            <tr>
                <th>METAL</th>
                <th>SHAPE</th>
                <th>DIM 1</th>
                <th>DIM 2</th>
                <th>THK</th>
                <th>LENGTH</th>
                <th>QTY</th>
                <th>WT (kg)</th>
                <th>SURF (m¬≤)</th>
                <th>DEL</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr>
                <td>
                    <select class="metal-sel" onchange="calculateRow(this)">
                        <option value="Steel">Steel</option>
                        <option value="Aluminum">Aluminum</option>
                        <option value="Stainless">Stainless</option>
                    </select>
                </td>
                <td>
                    <select class="shape-sel" onchange="calculateRow(this)">
                        <option value="">Select</option>
                        <option value="CHS">CHS</option>
                        <option value="RHS/SHS">RHS / SHS</option>
                        <option value="ROUND BAR">ROUND BAR</option>
                        <option value="FLAT BAR">FLAT BAR</option>
                        <option value="PLATE">PLATE</option>
                        <option value="ANGLE/TEE">ANGLE/TEE</option>
                        <option value="CHANNEL">CHANNEL</option>
                        <option value="SQ BAR">SQ BAR</option>
                        <option value="REBAR">REBAR</option>
                        <option value="HEX BAR">HEX BAR</option>
<!-- HEA -->
<!-- ================= HEB ================= -->
<option value="HEB 100" data-weight="20.4" data-surface="0.80">HEB 100</option>
<option value="HEB 120" data-weight="26.7" data-surface="0.95">HEB 120</option>
<option value="HEB 140" data-weight="33.7" data-surface="1.10">HEB 140</option>
<option value="HEB 160" data-weight="42.6" data-surface="1.30">HEB 160</option>
<option value="HEB 180" data-weight="51.2" data-surface="1.50">HEB 180</option>
<option value="HEB 200" data-weight="61.3" data-surface="1.70">HEB 200</option>
<option value="HEB 220" data-weight="71.3" data-surface="1.95">HEB 220</option>
<option value="HEB 240" data-weight="83.2" data-surface="2.20">HEB 240</option>
<option value="HEB 260" data-weight="93"   data-surface="2.45">HEB 260</option>
<option value="HEB 280" data-weight="103"  data-surface="2.70">HEB 280</option>
<option value="HEB 300" data-weight="117"  data-surface="3.00">HEB 300</option>
<option value="HEB 320" data-weight="127"  data-surface="3.25">HEB 320</option>
<option value="HEB 340" data-weight="134"  data-surface="3.45">HEB 340</option>
<option value="HEB 360" data-weight="146"  data-surface="3.70">HEB 360</option>
<option value="HEB 400" data-weight="171"  data-surface="4.20">HEB 400</option>
<option value="HEB 450" data-weight="211"  data-surface="4.90">HEB 450</option>
<option value="HEB 500" data-weight="245"  data-surface="5.60">HEB 500</option>
<option value="HEB 550" data-weight="291"  data-surface="6.40">HEB 550</option>
<option value="HEB 600" data-weight="337"  data-surface="7.20">HEB 600</option>
<option value="HEB 650" data-weight="385"  data-surface="8.10">HEB 650</option>

<!-- ================= IPN ================= -->
<option value="IPN 80"  data-weight="6"    data-surface="0.45">IPN 80</option>
<option value="IPN 100" data-weight="8.1"  data-surface="0.55">IPN 100</option>
<option value="IPN 120" data-weight="10.4" data-surface="0.65">IPN 120</option>
<option value="IPN 140" data-weight="12.9" data-surface="0.78">IPN 140</option>
<option value="IPN 160" data-weight="15.8" data-surface="0.90">IPN 160</option>
<option value="IPN 180" data-weight="18.8" data-surface="1.05">IPN 180</option>
<option value="IPN 200" data-weight="22.4" data-surface="1.20">IPN 200</option>
<option value="IPN 220" data-weight="26.2" data-surface="1.35">IPN 220</option>
<option value="IPN 240" data-weight="30.7" data-surface="1.55">IPN 240</option>
<option value="IPN 260" data-weight="35.8" data-surface="1.75">IPN 260</option>
<option value="IPN 280" data-weight="41"   data-surface="1.95">IPN 280</option>
<option value="IPN 300" data-weight="46.2" data-surface="2.15">IPN 300</option>
<option value="IPN 320" data-weight="52.7" data-surface="2.40">IPN 320</option>
<option value="IPN 340" data-weight="59.4" data-surface="2.65">IPN 340</option>
<option value="IPN 360" data-weight="66.3" data-surface="2.95">IPN 360</option>
<option value="IPN 380" data-weight="73.4" data-surface="3.20">IPN 380</option>
<option value="IPN 400" data-weight="81"   data-surface="3.50">IPN 400</option>
<option value="IPN 450" data-weight="92"   data-surface="4.00">IPN 450</option>
<option value="IPN 500" data-weight="103"  data-surface="4.50">IPN 500</option>
<option value="IPN 550" data-weight="116"  data-surface="5.10">IPN 550</option>

<!-- ================= IPE ================= -->
<option value="IPE 80"  data-weight="6"    data-surface="0.325">IPE 80</option>
<option value="IPE 100" data-weight="8.1"  data-surface="0.54">IPE 100</option>
<option value="IPE 120" data-weight="10.4" data-surface="0.64">IPE 120</option>
<option value="IPE 140" data-weight="12.9" data-surface="0.76">IPE 140</option>
<option value="IPE 160" data-weight="15.8" data-surface="0.88">IPE 160</option>
<option value="IPE 180" data-weight="18.8" data-surface="1.02">IPE 180</option>
<option value="IPE 200" data-weight="22.4" data-surface="1.18">IPE 200</option>
<option value="IPE 220" data-weight="26.2" data-surface="1.32">IPE 220</option>
<option value="IPE 240" data-weight="30.7" data-surface="1.50">IPE 240</option>
<option value="IPE 270" data-weight="36.2" data-surface="1.75">IPE 270</option>
<option value="IPE 300" data-weight="42.2" data-surface="2.00">IPE 300</option>
<option value="IPE 330" data-weight="49.1" data-surface="2.30">IPE 330</option>
<option value="IPE 360" data-weight="57.1" data-surface="2.65">IPE 360</option>
<option value="IPE 400" data-weight="66.3" data-surface="3.05">IPE 400</option>
<option value="IPE 450" data-weight="77.6" data-surface="3.60">IPE 450</option>
<option value="IPE 500" data-weight="90.7" data-surface="4.20">IPE 500</option>
<option value="IPE 550" data-weight="106"  data-surface="4.85">IPE 550</option>
<option value="IPE 600" data-weight="122"  data-surface="5.50">IPE 600</option>

<!-- ================= HEA ================= -->
<option value="HEA 100" data-weight="16.7" data-surface="0.62">HEA 100</option>
<option value="HEA 120" data-weight="20.4" data-surface="0.74">HEA 120</option>
<option value="HEA 140" data-weight="25.3" data-surface="0.88">HEA 140</option>
<option value="HEA 160" data-weight="30.4" data-surface="1.02">HEA 160</option>
<option value="HEA 180" data-weight="35.5" data-surface="1.16">HEA 180</option>
<option value="HEA 200" data-weight="42.3" data-surface="1.32">HEA 200</option>
<option value="HEA 220" data-weight="50.5" data-surface="1.50">HEA 220</option>
<option value="HEA 240" data-weight="60.3" data-surface="1.70">HEA 240</option>
<option value="HEA 260" data-weight="68.2" data-surface="1.90">HEA 260</option>
<option value="HEA 280" data-weight="76.4" data-surface="2.10">HEA 280</option>
<option value="HEA 300" data-weight="88.3" data-surface="2.35">HEA 300</option>
<option value="HEA 320" data-weight="97.6" data-surface="2.55">HEA 320</option>
<option value="HEA 340" data-weight="105"  data-surface="2.75">HEA 340</option>
<option value="HEA 360" data-weight="115"  data-surface="3.00">HEA 360</option>
<option value="HEA 400" data-weight="134"  data-surface="3.40">HEA 400</option>
<option value="HEA 450" data-weight="159"  data-surface="3.95">HEA 450</option>
<option value="HEA 500" data-weight="187"  data-surface="4.55">HEA 500</option>
<option value="HEA 550" data-weight="219"  data-surface="5.20">HEA 550</option>
<option value="HEA 600" data-weight="252"  data-surface="5.90">HEA 600</option>
<option value="HEA 650" data-weight="289"  data-surface="6.60">HEA 650</option>

<!-- ================= UPN ================= -->
<option value="UPN 50"  data-weight="5.59" data-surface="0.232">UPN 50</option>
<option value="UPN 60"  data-weight="5.07" data-surface="0.253">UPN 60</option>
<option value="UPN 65"  data-weight="7.09" data-surface="0.273">UPN 65</option>
<option value="UPN 80"  data-weight="8.64" data-surface="0.312">UPN 80</option>
<option value="UPN 100" data-weight="10.6" data-surface="0.372">UPN 100</option>
<option value="UPN 120" data-weight="13.4" data-surface="0.434">UPN 120</option>
<option value="UPN 140" data-weight="16"   data-surface="0.489">UPN 140</option>
<option value="UPN 160" data-weight="18.8" data-surface="0.546">UPN 160</option>
<option value="UPN 180" data-weight="22"   data-surface="0.611">UPN 180</option>
<option value="UPN 200" data-weight="25.3" data-surface="0.661">UPN 200</option>
<option value="UPN 220" data-weight="29.4" data-surface="0.718">UPN 220</option>
<option value="UPN 240" data-weight="33.2" data-surface="0.775">UPN 240</option>
<option value="UPN 260" data-weight="37.9" data-surface="0.834">UPN 260</option>
<option value="UPN 280" data-weight="41.8" data-surface="0.890">UPN 280</option>
<option value="UPN 300" data-weight="46.2" data-surface="0.950">UPN 300</option>
<option value="UPN 320" data-weight="59.5" data-surface="0.982">UPN 320</option>
<option value="UPN 350" data-weight="60.6" data-surface="1.05">UPN 350</option>
<option value="UPN 380" data-weight="63.1" data-surface="1.110">UPN 380</option>
<option value="UPN 400" data-weight="71.8" data-surface="1.180">UPN 400</option>
                    </select>
                </td>
                <td><input type="number" oninput="calculateRow(this)"></td>
                <td><input type="number" oninput="calculateRow(this)"></td>
                <td><input type="number" oninput="calculateRow(this)"></td>
                <td><input type="number" value="1000" oninput="calculateRow(this)"></td>
                <td><input type="number" value="1" oninput="calculateRow(this)"></td>
                <td><span>0</span></td>
                <td><span>0</span></td>
                <td><button class="del-btn" onclick="removeRow(this)">‚ùå</button></td>
            </tr>
            <tr id="totalRow">
                <td colspan="7" style="text-align:right">TOTAL</td>
                <td><span id="totalWT">0</span></td>
                <td><span id="totalSA">0</span></td>
                <td></td>
            </tr>
        </tbody>
    </table>

    <div class="btn-group">
        <button class="action-btn add-row" onclick="addRow()">+ Add Row</button>
        <button class="action-btn export-xls" onclick="downloadExcel()">üìä Export Excel</button>
    </div>
</div>

<div class="calculator">
    <div class="history-panel" id="historyLog">
        <div style="text-align:center; color:#666; margin-top:20px;">History Empty</div>
    </div>
    <input type="text" class="display" id="display" placeholder="0" autocomplete="off">
    <div class="buttons">
        <button class="calc-btn clear" onclick="clearDisplay()">C</button>
        <button class="calc-btn operator" onclick="appendValue('/')">/</button>
        <button class="calc-btn operator" onclick="appendValue('*')">√ó</button>
        <button class="calc-btn operator" onclick="appendValue('-')">-</button>
        <button class="calc-btn" onclick="appendValue('7')">7</button>
        <button class="calc-btn" onclick="appendValue('8')">8</button>
        <button class="calc-btn" onclick="appendValue('9')">9</button>
        <button class="calc-btn operator" onclick="appendValue('+')">+</button>
        <button class="calc-btn" onclick="appendValue('4')">4</button>
        <button class="calc-btn" onclick="appendValue('5')">5</button>
        <button class="calc-btn" onclick="appendValue('6')">6</button>
        <button class="calc-btn" onclick="appendValue('.')">.</button>
        <button class="calc-btn" onclick="appendValue('1')">1</button>
        <button class="calc-btn" onclick="appendValue('2')">2</button>
        <button class="calc-btn" onclick="appendValue('3')">3</button>
        <button class="calc-btn equal" onclick="calculate()">=</button>
        <button class="calc-btn" onclick="appendValue('0')" style="grid-column: span 2;">0</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
/* MATERIAL TABLE LOGIC */
const densities = { "Steel": 7850, "Aluminum": 2700, "Stainless": 8000 };
const manualShapes = ["CHS", "RHS/SHS", "ROUND BAR", "FLAT BAR", "PLATE", "ANGLE/TEE", "CHANNEL", "SQ BAR", "REBAR", "HEX BAR"];

function calculateRow(el) {
    const row = el.closest("tr");
    const metalSel = row.querySelector(".metal-sel");
    const shapeSel = row.querySelector(".shape-sel");
    const shape = shapeSel.value;

    if (shape !== "" && !manualShapes.includes(shape)) {
        metalSel.value = "Steel"; metalSel.disabled = true; metalSel.classList.add("disabled-select");
    } else {
        metalSel.disabled = false; metalSel.classList.remove("disabled-select");
    }
    
    updateHighlight(row, shape);
    const opt = shapeSel.options[shapeSel.selectedIndex];
    const stdWt = parseFloat(opt.getAttribute("data-weight")) || 0;
    const stdSA = parseFloat(opt.getAttribute("data-surface")) || 0;
    const d1 = parseFloat(row.cells[2].querySelector("input").value) || 0;
    const d2 = parseFloat(row.cells[3].querySelector("input").value) || 0;
    const thk = parseFloat(row.cells[4].querySelector("input").value) || 0;
    const len = parseFloat(row.cells[5].querySelector("input").value) || 0;
    const qty = parseFloat(row.cells[6].querySelector("input").value) || 1;
    const rho = densities[metalSel.value];
    let wt = 0, sa = 0;
    const L = len / 1000;

    if (stdWt > 0) {
        wt = stdWt * L * qty; sa = stdSA * L * qty;
    } else {
        switch(shape) {
            case 'CHS': wt = (Math.PI * (Math.pow(d1/2, 2) - Math.pow((d1 - 2*thk)/2, 2)) / 1000000) * rho * L; sa = (Math.PI * d1 / 1000) * L; break;
            case 'RHS/SHS': wt = ((d1 * d2 - (d1 - 2*thk) * (d2 - 2*thk)) / 1000000) * rho * L; sa = (2 * (d1 + d2) / 1000) * L; break;
            case 'ROUND BAR':
            case 'REBAR': wt = (Math.PI * Math.pow(d1/2, 2) / 1000000) * rho * L; sa = (Math.PI * d1 / 1000) * L; break;
            case 'FLAT BAR': wt = (d1 * thk / 1000000) * rho * L; sa = (2 * (d1 + thk) / 1000) * L; break;
            case 'PLATE': wt = (d1 * d2 * thk / 1000000000) * rho; sa = (2 * (d1 * d2) / 1000000); break;
            case 'ANGLE/TEE': wt = ((d1 + d2 - thk) * thk / 1000000) * rho * L; sa = (2 * (d1 + d2) / 1000) * L; break;
            case 'CHANNEL': wt = ((d1 + 2*d2 - 2*thk) * thk / 1000000) * rho * L; sa = (2 * (d1 + 2*d2) / 1000) * L; break;
            case 'SQ BAR': wt = (d1 * d1 / 1000000) * rho * L; sa = (4 * d1 / 1000) * L; break;
            case 'HEX BAR': wt = (0.866 * Math.pow(d1, 2) / 1000000) * rho * L; sa = (3.464 * d1 / 1000) * L; break;
        }
        wt *= qty; sa *= qty;
    }
    row.cells[7].querySelector("span").innerText = wt.toFixed(2);
    row.cells[8].querySelector("span").innerText = sa.toFixed(2);
    updateTotals();
}

function updateHighlight(row, shape) {
    const inputs = [row.cells[2].querySelector("input"), row.cells[3].querySelector("input"), row.cells[4].querySelector("input")];
    inputs.forEach(i => i.classList.remove("red-input"));
    if (["CHS", "FLAT BAR"].includes(shape)) { inputs[0].classList.add("red-input"); inputs[2].classList.add("red-input"); }
    else if (["RHS/SHS", "PLATE", "ANGLE/TEE", "CHANNEL"].includes(shape)) { inputs.forEach(i => i.classList.add("red-input")); }
    else if (manualShapes.includes(shape)) { inputs[0].classList.add("red-input"); }
}

function updateTotals() {
    let tw = 0, ts = 0;
    document.querySelectorAll("#tableBody tr:not(#totalRow)").forEach(r => {
        tw += parseFloat(r.cells[7].querySelector("span").innerText) || 0;
        ts += parseFloat(r.cells[8].querySelector("span").innerText) || 0;
    });
    document.getElementById("totalWT").innerText = tw.toFixed(2);
    document.getElementById("totalSA").innerText = ts.toFixed(2);
}

function addRow() {
    const tbody = document.getElementById("tableBody");
    const newRow = tbody.rows[0].cloneNode(true);
    newRow.querySelector(".metal-sel").disabled = false;
    newRow.querySelector(".metal-sel").classList.remove("disabled-select");
    newRow.querySelectorAll("input").forEach(i => i.value = i.defaultValue || "");
    newRow.querySelectorAll("span").forEach(s => s.innerText = "0");
    tbody.insertBefore(newRow, document.getElementById("totalRow"));
}

function removeRow(btn) {
    if (document.getElementById("tableBody").rows.length > 2) btn.closest("tr").remove(); updateTotals();
}

function downloadExcel() {
    const rows = [["METAL", "SHAPE", "DIM 1", "DIM 2", "THK", "LENGTH", "QTY", "WT (kg)", "SURF (m¬≤)"]];
    document.querySelectorAll("#tableBody tr").forEach(tr => {
        if (tr.id === "totalRow") { rows.push(["","","","","","","TOTAL", tr.cells[1].innerText, tr.cells[2].innerText]); return; }
        rows.push([tr.querySelector(".metal-sel").value, tr.querySelector(".shape-sel").value, tr.cells[2].querySelector("input").value, tr.cells[3].querySelector("input").value, tr.cells[4].querySelector("input").value, tr.cells[5].querySelector("input").value, tr.cells[6].querySelector("input").value, tr.cells[7].innerText, tr.cells[8].innerText]);
    });
    const ws = XLSX.utils.aoa_to_sheet(rows);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Materials");
    XLSX.writeFile(wb, "Material_List.xlsx");
}

/* CALCULATOR LOGIC */
const disp = document.getElementById('display');
const log = document.getElementById('historyLog');

function appendValue(v) { disp.value += v; }
function clearDisplay() { disp.value = ''; }
function calculate() {
    let expr = disp.value; if (!expr) return;
    try {
        let res = new Function('return ' + expr.replace(/√ó/g, '*'))();
        addHistory(expr, res); disp.value = res;
    } catch (e) { disp.value = 'Error'; setTimeout(clearDisplay, 1000); }
}
function addHistory(e, r) {
    if(log.innerHTML.includes('History Empty')) log.innerHTML = '';
    const div = document.createElement('div'); div.className = 'history-item';
    div.innerHTML = `${e} = <strong>${r}</strong>`;
    div.onclick = () => { disp.value = r; };
    log.prepend(div); log.scrollTop = 0;
}

// Keyboard Support
window.addEventListener('keydown', (e) => {
    if (document.activeElement.tagName === 'INPUT' && document.activeElement !== disp) return;
    if ('0123456789+-*/.'.includes(e.key)) { e.preventDefault(); appendValue(e.key); }
    else if (e.key === 'Enter') { e.preventDefault(); calculate(); }
    else if (e.key === 'Backspace' && document.activeElement !== disp) { disp.value = disp.value.slice(0, -1); }
    else if (e.key === 'Escape') { clearDisplay(); }
});

/* Security */
document.addEventListener("contextmenu", e => e.preventDefault());
</script>
</body>
</html>